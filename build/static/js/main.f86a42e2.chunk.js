(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{112:function(e,t){},117:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(54),c=a.n(s),o=(a(76),a(77),a(35)),u=a(13),l=a(5),i=a.n(l),m=a(10),p=a(17),f=a(118),g=a(120),h=a(119),d=a(56),v=a(121),S=a(14),E=a.n(S);var b=function(){return n.a.createElement("div",{id:"loader-container"},n.a.createElement("img",{width:"120px",src:a(79)}))},O={BASE_URL:"https://izaan-chat-app.herokuapp.com"};var y=function(e){var t=Object(r.useState)(""),a=Object(p.a)(t,2),s=a[0],c=a[1],o=Object(r.useState)(!1),u=Object(p.a)(o,2),l=u[0],S=u[1];function y(){return(y=Object(m.a)(i.a.mark((function t(a){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.prev=1,S(!0),t.next=5,fetch("".concat(O.BASE_URL,"/api/user?name=").concat(s));case 5:return r=t.sent,t.next=8,r.json();case 8:if(n=t.sent,200===r.status){t.next=11;break}throw new Error(n.message);case 11:localStorage.setItem("user",JSON.stringify(n.user)),e.history.push("/users"),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),E.a.fire("Error!",t.t0.message,"error");case 18:S(!1);case 19:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}return n.a.createElement(f.a,{className:"h-100vh d-flex justify-content-center align-items-center"},n.a.createElement(g.a,{onSubmit:function(e){return y.apply(this,arguments)},className:"w-100"},n.a.createElement(h.a,null,n.a.createElement(d.a,{value:s,onChange:function(e){c(e.target.value)},type:"text",placeholder:"Enter your name..."}),n.a.createElement(v.a,{type:"submit"},"Submit"))),l&&n.a.createElement(b,null))},x=a(38),j=a(57),w=a(58),k=a(67),N=a(59),J=a(68),_=a(122),I=a(60),C=a.n(I);var L=Object(u.f)((function(e){var t=JSON.parse(localStorage.getItem("otherUser")||{}),a=JSON.parse(localStorage.getItem("user")||{});return n.a.createElement("div",{id:"header-container"},n.a.createElement("span",null,"Chatting with ",t.name),n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"mr-2"},a.name),n.a.createElement(v.a,{onClick:function(){e.history.replace("/")}},"Logout")))})),U=a(69);var A=function(e){var t="#3498db",a="flex-end";return"other"===e.type&&(t="#2ecc71",a="flex-start"),n.a.createElement(U.a,{className:"my-1",style:{backgroundColor:t,color:"white",width:"80%",alignSelf:a}},e.children)},B={},R=function(e){function t(){var e,a;Object(j.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(k.a)(this,(e=Object(N.a)(t)).call.apply(e,[this].concat(n)))).state={messages:[],message:"",isLoading:!1},a.fetchMessages=Object(m.a)(i.a.mark((function e(){var t,r,n,s,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=JSON.parse(localStorage.getItem("room")),r=JSON.parse(localStorage.getItem("user")),n={room:t._id,user:r._id},s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e.next=7,fetch("".concat(O.BASE_URL,"/api/user/message"),s);case 7:return c=e.sent,e.next=10,c.json();case 10:o=e.sent,a.setState({messages:o.messages}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),E.a.fire("Error!",e.t0.message,"error");case 17:return e.abrupt("return",{message:"success"});case 18:case"end":return e.stop()}}),e,null,[[0,14]])}))),a.setupListener=function(){var e=C()("".concat(O.BASE_URL,"/chat"));B.socket=e;var t=JSON.parse(localStorage.getItem("room")),r={user:JSON.parse(localStorage.getItem("user"))._id,room:t._id};e.on("connect",(function(){e.emit("room-join",r)})),e.on("new-message",(function(e){var t=a.state.messages;a.setState({messages:[].concat(Object(x.a)(t),[{message:e.message,user:e.user}])})}))},a.handleChange=function(e){a.setState({message:e.target.value})},a.sendMessage=function(){var e=Object(m.a)(i.a.mark((function e(t){var r,n,s,c,o,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.state,n=r.messages,s=r.message,t.preventDefault(),c=JSON.parse(localStorage.getItem("user")),o=JSON.parse(localStorage.getItem("room")),u=JSON.parse(localStorage.getItem("otherUser")),l={message:s,user:c._id,room:o._id,otherUser:u._id},a.setState({messages:[].concat(Object(x.a)(n),[{message:s,user:c._id}])}),B.socket.emit("new-message",l);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return Object(J.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){var e=Object(m.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchMessages();case 2:this.setupListener();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.messages,a=e.message,r=JSON.parse(localStorage.getItem("user"))._id;return n.a.createElement(f.a,{className:"h-100vh d-flex flex-column"},n.a.createElement(L,null),n.a.createElement(_.a,{className:"my-2 d-flex flex-column flex-grow-1",style:{overflowY:"auto"}},t.map((function(e){return console.log("item.user =>",e.user),console.log("user =>",r),console.log("item.user === user =>",e.user===r),n.a.createElement(A,{type:e.user===r?"self":"other"},e.message)}))),n.a.createElement(g.a,{onSubmit:this.sendMessage,className:"my-2"},n.a.createElement(h.a,null,n.a.createElement(d.a,{value:a,onChange:this.handleChange,type:"text",placeholder:"Enter message..."}),n.a.createElement(v.a,{type:"submit"},"Send"))))}}]),t}(r.Component);function M(e){return n.a.createElement(U.a,{onClick:function(){return e.onClick(e.data)}},e.children)}M.defaultProps={onClick:function(){}};var T=M;var D=function(e){var t=Object(r.useState)([]),a=Object(p.a)(t,2),s=a[0],c=a[1],o=Object(r.useState)(!1),u=Object(p.a)(o,2),l=u[0],g=u[1];function h(){return(h=Object(m.a)(i.a.mark((function e(){var t,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(localStorage.getItem("user")),e.prev=1,g(!0),e.next=5,fetch("".concat(O.BASE_URL,"/api/users?user=").concat(t._id));case 5:return a=e.sent,e.next=8,a.json();case 8:if(r=e.sent,200===a.status){e.next=11;break}throw new Error(r.message);case 11:c(r.users),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),E.a.fire("Error!",e.t0.message,"error");case 17:g(!1);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function d(e){return v.apply(this,arguments)}function v(){return(v=Object(m.a)(i.a.mark((function t(a){var r,n,s,c,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,g(!0),r=JSON.parse(localStorage.getItem("user")),n={user1:r._id,user2:a._id},s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},t.next=7,fetch("".concat(O.BASE_URL,"/api/room"),s);case 7:return c=t.sent,t.next=10,c.json();case 10:if(o=t.sent,200===c.status){t.next=13;break}throw new Error(o.message);case 13:console.log(o),localStorage.setItem("room",JSON.stringify(o.room)),localStorage.setItem("otherUser",JSON.stringify(a)),e.history.push("/chat"),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),E.a.fire("Error!",t.t0.message,"error");case 22:g(!1);case 23:case"end":return t.stop()}}),t,null,[[0,19]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){!function(){h.apply(this,arguments)}()}),[]),n.a.createElement(f.a,{className:"my-2"},s.map((function(e){return n.a.createElement(T,{key:e._id,data:e,onClick:d},e.name)})),l&&n.a.createElement(b,null))};function P(){return n.a.createElement(o.a,null,n.a.createElement(u.c,null,n.a.createElement(u.a,{exact:!0,path:"/",component:y}),n.a.createElement(u.a,{path:"/users",component:D}),n.a.createElement(u.a,{path:"/chat",component:R})))}var z=function(){return n.a.createElement(P,null)};c.a.render(n.a.createElement(z,null),document.getElementById("root"))},71:function(e,t,a){e.exports=a(117)},77:function(e,t,a){},79:function(e,t,a){e.exports=a.p+"static/media/loader3.6482bfd7.gif"}},[[71,1,2]]]);
//# sourceMappingURL=main.f86a42e2.chunk.js.map